<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>F1TECH | Página Inicial</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/estilo.css">
  <link rel="icon" href="./assets/icon/favicon2.ico">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <style>
    /* Estilos para layout da história da Fórmula 1 */

    .section {
      background-color: #f9f9f9;
    }

    .section .container {
      margin: 0 auto;
      display: flex;
      align-items: center;
      flex-direction: column;
      border-top: solid 10px #e10600;
    }

    .impar {
      border-right: solid 10px #e10600;
      border-top-right-radius: 25px;
      border-bottom-right-radius: 25px;
    }

    .par {
      border-left: solid 10px #e10600;
      border-top-left-radius: 25px;
      border-bottom-left-radius: 25px;
    }

    .section .content,
    .historia {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .section .content {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      width: 100%;
    }

    .section .info {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .section .info h2 {
      color: #333;
      font-size: 50px;
      margin-bottom: 10px;
    }

    .section .info p {
      color: #666;
      font-size: 20px;
      line-height: 1.6;
      margin-bottom: 10px;
      text-decoration: none;
    }

    .section .info a {
      text-decoration: none;
    }

    .img-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 20px;
    }

    .images {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      margin-top: 10px;
    }

    .img-piloto {
      width: 300px;
      margin-bottom: 10px;
      margin-top: 40px;

    }

    .logo-equipe {
      max-width: 80px;
    }

    .logo-numero {
      max-width: 100px;
    }

    .section .historia {
      color: #666;
      font-size: 20px;
      line-height: 1.6;
      margin-top: -95px;
      width: 100%;
    }

    .section.equipe {
      background-color: #f0f0f0;
      padding: 20px;
    }

    .section.equipe .container {
      max-width: 70%;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .section.equipe h2 {
      color: #333;
      font-size: 24px;
      margin-bottom: 10px;
    }

    .section.equipe .logo-equipe {
      max-width: 100px;
      margin-bottom: 10px;
    }

    .section.equipe .pilotos {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }

    .section.equipe .pilotos .piloto {
      text-align: center;
    }

    .section.equipe .pilotos p {
      font-size: 25px;
      color: black;
      font-weight: 700;
    }

    .section.equipe .pilotos a {
      text-decoration: none !important;
    }

    .section.equipe .img-piloto {
      width: 200px;
      margin-top: 10px;
    }

    .section.equipe .carro {
      margin-top: 20px;
    }

    .section.equipe .carro img {
      max-width: 1000px;
    }

    .section.equipe .historia {
      display: none;
      margin-top: 20px;
      margin-left: 10px;
      max-width: 80%;
    }

    .section.equipe .historia p {
      font-size: 18px;
    }

    .section.equipe .mostrar-historia {
      cursor: pointer;
      color: #000000;
      margin-top: 10px;
      font-size: 30px;
      font-weight: 700;
      display: contents;
      align-items: center;
    }

    .section.equipe .mostrar-historia:hover {
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="container">
      <img src="./assets/imgs/logo.png">
      <ul class="navbar">
        <li class="agora">
          <a href="#">Inicial</a>
        </li>
        <li>
          <a href="ranking.html">Ranking</a>
        </li>
        <li>|</li>
        <li>
          <a href="login.html">Login</a>
        </li>
        <li>
          <a href="cadastro.html">Cadastro</a>
        </li>
      </ul>
    </div>
  </div>

  <div class="banner">
    <div class="container">
      <p>Preservando <span>hoje</span> para existirem <span>amanhã</span>.</p>
      <a href="#history" class="button">Conheça mais sobre a história da Fórmula 1</a>
    </div>
  </div>

  <div id="equipe-template" class="section equipe">
  </div>

  <div id="piloto-template" class="section piloto">
  </div>

  <div class="footer">
    <div class="container">
      <h4>Feito por Arthur Ramos &hearts; SPTech &copy; 2024</h4>
      <span class="version">v1.0.0</span>
    </div>
  </div>

</body>

</html>

<script>
  document.addEventListener("DOMContentLoaded", async function () {
    try {
      // Chama as funções de listagem de pilotos e equipes e espera que ambas sejam concluídas
      await Promise.all([listarPilotos(), listarEquipes()]);

      // Após ambas as listas estarem preenchidas, preenche o template
      preencherTemplate();
      preencherEquipes();
    } catch (error) {
      console.error("Erro ao carregar dados:", error);
    }
  })

  let equipesData = {};

  function listarEquipes() {
    return fetch("/equipe/listarEquipe", {
      method: "GET",
    })
      .then(function (resposta) {
        return resposta.json();
      })
      .then((equipes) => {
        equipes.forEach((equipe) => {
          // Armazenar as informações das equipes em um objeto usando o ID da equipe como chave
          equipesData[equipe.idEquipe] = equipe;
        });
      })
      .catch(function (erro) {
        console.error(`#ERRO: ${erro}`);
      });
  }

  let pilotosData = [];

  function listarPilotos() {
    return fetch('/piloto/listarPiloto', {
      method: 'GET',
    })
      .then(function (resposta) {
        return resposta.json();
      })
      .then((pilotos) => {
        pilotosData = pilotos;
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function formatarData(data) {
    // Função para formatar a data no formato desejado (XX/xx/xx)
    const dataObj = new Date(data);
    const dia = dataObj.getDate().toString().padStart(2, '0');
    const mes = (dataObj.getMonth() + 1).toString().padStart(2, '0');
    const ano = dataObj.getFullYear().toString();
    return `${dia}/${mes}/${ano}`;
  }

  function preencherTemplate() {
    const pilotoContainer = document.getElementById('piloto-template');
    pilotoContainer.innerHTML = ''; // Limpa o conteúdo do template

    pilotosData.forEach((piloto) => {
      // Verificar se o piloto tem uma equipe atribuída (fkEquipe)
      if (piloto.fkEquipe) {
        const equipe = equipesData[piloto.fkEquipe]; // Recupera os dados da equipe correspondente
        const pilotoDiv = document.createElement('div');
        pilotoDiv.classList.add('container');
        pilotoDiv.innerHTML = `
            <div class="content" id="${piloto.idPiloto}.piloto">
                    <div class="info">
                        <h2>${piloto.nome}</h2>
                        <p><strong>Data de nascimento:</strong> ${formatarData(piloto.dataNasc)}</p>
                        <p><strong>Numero:</strong> ${piloto.NumPiloto}</p>
                        <a href="#${equipe.idEquipe}.equipe"><p><strong>Equipe Atual:</strong> ${equipe.nome}</p></a>
                        <p><strong>Títulos:</strong> ${piloto.titulos || 0}</p>
                    </div>
                    <div class="img-container">
                        <img src="${piloto.imgPiloto}" class="img-piloto">
                        <div class="images">
                            <img src="${piloto.imgNumPiloto}" class="logo-numero">
                            <a href="#${equipe.idEquipe}.equipe"><img src="${equipe.logo}" class="logo-equipe"></a>
                        </div>
                    </div>
                </div>
                <div class="historia">
                    <p><strong>História:</strong></p>
                    <p>${piloto.historia}</p>
                </div>
            `;
        pilotoContainer.appendChild(pilotoDiv);
      }
    });
  }

  function preencherEquipes() {
    const equipeContainer = document.getElementById('equipe-template');
    equipeContainer.innerHTML = ''; // Limpa o conteúdo do template

    Object.values(equipesData).forEach((equipe) => {
      const pilotosDaEquipe = pilotosData.filter(piloto => piloto.fkEquipe === equipe.idEquipe);
      const equipeDiv = document.createElement('div');
      equipeDiv.classList.add('container');
      equipeDiv.classList.add(equipe.idEquipe % 2 === 0 ? 'par' : 'impar');
      equipeDiv.innerHTML = `
        <h2 id="${equipe.idEquipe}.equipe" class="section equipe">${equipe.nome}</h2>
        <img src="${equipe.logo}" class="logo-equipe">
        <div class="pilotos">
          ${pilotosDaEquipe.map(piloto => `
            <a href="#${piloto.idPiloto}.piloto">
              <div class="piloto">
                <p>${piloto.nome}</p>
                <img src="${piloto.imgPiloto}" class="img-piloto">
              </div>
            </a>
          `).join('')}
        </div>  
        <div class="carro">
          <img src="${equipe.imgCarro}">
        </div>
        <div class="mostrar-historia">
          <p>Conheça mais sobre a história da ${equipe.nome}</p>
          <img src="./assets/imgs/setaBaixo.png">
        </div>
        <div class="historia equipe" style="display: none;">
          <p><strong>História da Equipe:</strong></p>
          <p>${equipe.historia}</p>
        </div>

      `;
      equipeContainer.appendChild(equipeDiv);

      const mostrarHistoriaBtn = equipeDiv.querySelector('.mostrar-historia');
      const historiaEquipe = equipeDiv.querySelector('.historia');
      const setaImg = mostrarHistoriaBtn.querySelector('img');

      mostrarHistoriaBtn.addEventListener('click', () => {
        if (historiaEquipe.style.display === 'none') {
          historiaEquipe.style.display = 'block';
          setaImg.src = './assets/imgs/setaCima.png';
        } else {
          historiaEquipe.style.display = 'none';
          setaImg.src = './assets/imgs/setaBaixo.png';
        }
      });
    });
  }
</script>