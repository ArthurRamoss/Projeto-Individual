<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>F1TECH | Página Inicial</title>

    <script src="./js/sessao.js"></script>

    <link rel="stylesheet" href="./css/estilo.css">
    <link rel="icon" href="./assets/icon/favicon2.ico">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <style>
      /* Estilos para layout da história da Fórmula 1 */
      .section {
            background-color: #f9f9f9;
        }

        .section .container {
            max-width: 960px;
            margin: 0 auto;
            display: flex;
            align-items: center;
        }

        .section img {
            max-width: 200px;
            border-radius: 10px;
            margin-left: auto; /* Move image to the right */
        }

        .section .content {
            max-width: 70%;
        }

        .section .content h2 {
            color: #333;
            font-size: 50px;
            margin-bottom: 10px;
        }

        .section .content p {
            color: #666;
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .logo-equipe {
  max-width: 50px;
  margin-left: 10px;
}

.logo-numero {
  max-width: 50px;
  margin-top: 10px;
}

.images {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.images img {
  margin: 5px 0;
}

    </style>
</head>

<body>
    <div class="header">
      <div class="container">
        <img src="./assets/imgs/logo.png">
        <ul class="navbar">
          <li class="agora">
            <a href="#">Inicial</a>
          </li>
          <li>
            <a href="ranking.html">Ranking</a>
          </li>
          <li>|</li>
          <li>
            <a href="login.html">Login</a>
          </li>
          <li>
            <a href="cadastro.html">Cadastro</a>
          </li>
        </ul>
      </div>
    </div>
  
    <div class="banner">
      <div class="container">
        <p>Preservando <span>hoje</span> para existirem <span>amanhã</span>.</p>
        <a href="#history" class="button">Conheça mais sobre a história da Fórmula 1</a>
      </div>
    </div>
    
    <div id="piloto-template" class="section piloto">
      <div class="container">
          <div class="content">
              <h2>Nome do Piloto</h2>
              <p><strong>Data de nascimento:</strong> XX/xx/xx </p>
              <p><strong>Equipe Atual:</strong> Nome da Equipe</p>
              <p><strong>História:</strong></p>
              <p><strong></strong></p>
              <p>Breve descrição da história do piloto, conquistas, e detalhes importantes sobre sua carreira.</p>
          </div>
          <img src="../public/assets/imgs/av5.png" alt="Nome do Piloto">
      </div>
  </div>
    
  <div id="piloto-template" class="section piloto">
    <!-- Conteúdo será preenchido via JavaScript -->
  </div>

    <div class="footer">
      <div class="container">
        <h4>Feito com amor por aluno &hearts; SPTech &copy; 2023</h4>
        <span class="version">v1.0.0</span>
      </div>
    </div>
  </body>

</html>

<script>
  document.addEventListener("DOMContentLoaded", async function () {
      try {
          // Chama as funções de listagem de pilotos e equipes e espera que ambas sejam concluídas
          await Promise.all([listarPilotos(), listarEquipes()]);
  
          // Após ambas as listas estarem preenchidas, preenche o template
          preencherTemplate();
      } catch (error) {
          console.error("Erro ao carregar dados:", error);
      }
  })
  
  let equipesData = {};
  
  function listarEquipes() {
      return fetch("/equipe/listarEquipe", {
          method: "GET",
      })
      .then(function (resposta) {
          return resposta.json();
      })
      .then((equipes) => {
          equipes.forEach((equipe) => {
              // Armazenar as informações das equipes em um objeto usando o ID da equipe como chave
              equipesData[equipe.idEquipe] = equipe;
          });
      })
      .catch(function (erro) {
          console.error(`#ERRO: ${erro}`);
      });
  }
  
  let pilotosData = [];
  
  function listarPilotos() {
      return fetch('/piloto/listarPiloto', {
          method: 'GET',
      })
      .then(function (resposta) {
          return resposta.json();
      })
      .then((pilotos) => {
          pilotosData = pilotos;
      })
      .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
      });
  }

  function formatarData(data) {
    // Função para formatar a data no formato desejado (XX/xx/xx)
    const dataObj = new Date(data);
    const dia = dataObj.getDate().toString().padStart(2, '0');
    const mes = (dataObj.getMonth() + 1).toString().padStart(2, '0');
    const ano = dataObj.getFullYear().toString();
    return `${dia}/${mes}/${ano}`;
}
  
function preencherTemplate() {
    const pilotoContainer = document.getElementById('piloto-template');
    pilotoContainer.innerHTML = ''; // Limpa o conteúdo do template

    pilotosData.forEach((piloto) => {
        // Verificar se o piloto tem uma equipe atribuída (fkEquipe)
        if (piloto.fkEquipe) {
            const equipe = equipesData[piloto.fkEquipe]; // Recupera os dados da equipe correspondente
            const pilotoDiv = document.createElement('div');
            pilotoDiv.classList.add('container');
            pilotoDiv.innerHTML = `
                <div class="content">
                    <h2>${piloto.nome}</h2>
                    <p><strong>Data de nascimento:</strong> ${formatarData(piloto.dataNasc)}</p>
                    <p><strong>Numero:</strong> ${piloto.NumPiloto}</p>
                    <p><strong>Equipe Atual:</strong> ${equipe.nome} </p>
                    <p><strong>Títulos:</strong> ${piloto.titulos || 0}</p>
                    <p><strong>História:</strong></p>
                    <p>${piloto.historia}</p>
                </div>
                <div class="images">
                    <img src="${piloto.imgPiloto}" alt="${piloto.nome}">
                    <img src="${piloto.imgNumPiloto}" class="logo-numero">
                    <img src="${equipe.logo}" class="logo-equipe">
                </div>
            `;
            pilotoContainer.appendChild(pilotoDiv);
        }
    });
}
  </script>
