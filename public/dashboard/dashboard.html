<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaTech | Dashboards</title>

    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body onload="validarSessao(), carregarInfoUsuario()">

    <div class="janela">
        <div class="header-left">
            <h1>F1TECH</h1>

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="btn-nav-white">
                <a href="./cards.html">
                    <h3>Aquários</h3>
                </a>
            </div>

            <div class="btn-nav">
                <h3>Gráficos</h3>
            </div>

            <div class="btn-nav-white">
                <a href="./mural.html">
                    <h3>Mural de Avisos</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>

        <div class="dash">
            <div id="alerta">
            </div>

            <div id="user-info">
                <!-- Informações do usuário serão carregadas aqui -->
            </div>
        </div>
    </div>

</body>

</html>

<script>
    function carregarInfoUsuario() {
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
        const email = sessionStorage.getItem("EMAIL_USUARIO");

        if (email == undefined) {
            window.location.href = "../login.html";
            return;
        }

        fetch(`/usuario/listarInfo/${email}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao buscar informações do usuário");
                }
                return response.json();
            })
            .then(dados => {
                document.getElementById("b_usuario").textContent = dados.nome;
                document.getElementById("hello").innerHTML = `
                    <div>
                        <img src="${dados.imgPerfil}" alt="Foto de perfil de ${dados.nome}" />
                        <h3>Nome: ${dados.nome}</h3>
                        <img src="${dados.logoEquipe}" alt="Logo da equipe ${dados.nomeEquipe}" />
                        <img src="${dados.imgNumPiloto}" alt="Número do piloto ${dados.nomePiloto}" />
                    </div>
                `;
            })
            .catch(error => {
                console.error("Erro ao carregar informações do usuário:", error);
                window.location.href = "../login.html";
            });
    }
</script>